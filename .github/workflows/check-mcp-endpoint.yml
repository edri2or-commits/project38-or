# Quick check of MCP status endpoint
name: Check MCP Endpoint

on:
  workflow_dispatch:

permissions:
  contents: read
  issues: write

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check MCP Status Endpoint
        run: |
          echo "=== Health Check ==="
          curl -s https://or-infra.com/api/health | jq .

          echo ""
          echo "=== MCP Status ==="
          curl -s https://or-infra.com/api/mcp/status | jq .

          echo ""
          echo "=== MCP Test (direct call) ==="
          curl -s -X POST https://or-infra.com/api/mcp/test | jq .

          echo ""
          echo "=== MCP Call health_check ==="
          curl -s -X POST "https://or-infra.com/api/mcp/call?tool_name=health_check" | jq .

      - name: Post Results
        if: always()
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          HEALTH=$(curl -s https://or-infra.com/api/health 2>&1)
          MCP=$(curl -s https://or-infra.com/api/mcp/status 2>&1)
          MCP_TEST=$(curl -s -X POST https://or-infra.com/api/mcp/test 2>&1)
          MCP_CALL=$(curl -s -X POST "https://or-infra.com/api/mcp/call?tool_name=health_check" 2>&1)

          gh issue comment 509 --repo ${{ github.repository }} --body "## MCP Endpoint Check

          **Health:**
          \`\`\`json
          $HEALTH
          \`\`\`

          **MCP Status:**
          \`\`\`json
          $MCP
          \`\`\`

          **MCP Test (direct call):**
          \`\`\`json
          $MCP_TEST
          \`\`\`

          **MCP Call health_check:**
          \`\`\`json
          $MCP_CALL
          \`\`\`
          "
