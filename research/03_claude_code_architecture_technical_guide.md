המדריך הטכני המקיף ל-Claude Code: ארכיטקטורה, תצורה ושליטה אופרטיבית1. מבוא: פרדיגמה חדשה בפיתוח תוכנה אוטונומיהשקתו של Claude Code מסמנת נקודת מפנה באבולוציה של כלי פיתוח תוכנה, במעבר מעוזרי השלמת קוד (Autocomplete) פסיביים לסוכנים אוטונומיים (Agentic CLI) הפועלים ישירות בתוך המסוף (Terminal). בניגוד לתוספי IDE מסורתיים, המוגבלים לרוב להקשר של הקובץ הפתוח ולפעולות עריכה מקומיות, Claude Code מתפקד כיישות עצמאית בעלת יכולת התמצאות במרחב הקבצים, תכנון משימות רב-שלביות, וביצוע פעולות דטרמיניסטיות על מערכת ההפעלה.1ניתוח מעמיק של הארכיטקטורה חושף כי הכלי נבנה על בסיס פילוסופיית Unix, המדגישה מודולריות, יכולת הרכבה (Composability) וסקריפטביליות. היכולת לשרשר קלט באמצעות Pipelines (למשל, cat logs.txt | claude), לצד תמיכה במצבי עבודה אינטראקטיביים (REPL) ואוטומטיים (Print Mode), ממצבת אותו לא רק ככלי עזר למפתח הבודד אלא כרכיב אינטגרלי בשרשראות CI/CD מורכבות.3דו"ח מחקר זה נועד לשמש כבסיס ידע מקצועי ומקיף עבור מהנדסי DevOps, ארכיטקטי מערכת ומובילים טכנולוגיים. הוא מנתח את מנגנוני הליבה של הכלי, החל ממערכת הכלים (Tool Use) המובנית, דרך פרוטוקול ההקשר (MCP), ועד למנגנוני האבטחה והממשל (Governance) הנדרשים להטמעה בארגוני Enterprise. הניתוח מתבסס על תיעוד רשמי, לוגי שחרור ומאגרי קוד פתוח של Anthropic, תוך הצלבת מידע לזיהוי תבניות עבודה מומלצות ואילוצי אבטחה קריטיים.2. מערכת הכלים (The Tooling Ecosystem): סמנטיקה ויכולותבליבת היכולת האופרטיבית של Claude Code עומד מנגנון השימוש בכלים (Tool Use). המודל אינו מבצע שינויים בקוד באופן "קסום", אלא מתקשר עם הסביבה אך ורק דרך סט מוגדר של כלים, המשמשים כממשק (Interface) בין ההיסק ההסתברותי של ה-LLM לבין המצב הדטרמיניסטי של מערכת הקבצים. הבנה מעמיקה של כלים אלו, הפרמטרים שלהם וההרשאות הנדרשות עבורם, היא קריטית לשליטה בהתנהגות הסוכן.2.1. כלי התמצאות וניווט (File System Traversal)הסוכן נדרש לבנות "מפה מנטלית" של בסיס הקוד לפני ביצוע שינויים. הכלים בקטגוריה זו מאפשרים לו לחקור את ההיררכיה והתוכן של הפרויקט.שם הכליתיאור פונקציונליפרמטרים (Schema)הרשאות נדרשותתובנות אופרטיביותLSמיפוי תכולת תיקייה. מספק רשימת קבצים ותיקיות בנתיב נתון.path (String, Absolute Path)ignore (Array of Strings, Optional Glob patterns)Read (משתמע), לעיתים מסווג תחת LSהכלי תומך בפרמטר ignore הקריטי לסינון רעשים (כגון node_modules). השימוש בנתיבים אבסולוטיים הוא חובה למניעת דו-משמעות.4Globחיפוש קבצים מבוסס תבניות. מאפשר איתור קבצים ללא ידיעת מיקומם המדויק.pattern (String)Read / Globיעיל יותר מ-LS רקורסיבי עבור פרויקטים גדולים, שכן הוא מחזיר רק תוצאות רלוונטיות וחוסך ב-Tokens בהקשר השיחה.5Grepחיפוש סמנטי של תוכן בתוך קבצים. משמש לאיתור הגדרות פונקציות, מחרוזות שגיאה או שימושים במשתנים.pattern (String)path (String)Read / Grepהמודל מאומן להעדיף שימוש ב-Grep על פני קריאת קבצים מלאה (Read) כדי למזער את צריכת חלון ההקשר.5Readטעינת תוכן קובץ מלא לחלון ההקשר.file_path (String)Readפעולה "יקרה" במונחי Tokens. הסוכן משתמש בכלי זה רק לאחר שאיתר את הקבצים הרלוונטיים באמצעות LS או Grep.62.2. כלי שינוי וביצוע (Modification & Execution)כלים אלו מהווים את "הידיים" של הסוכן, ומאפשרים לו לבצע שינויים בפועל. השימוש בהם הוא המוקד העיקרי של מנגנוני האבטחה והבקרות (Hooks).Edit ו-Write: ההבדל הדקקיים אבחנה ארכיטקטונית בין עריכה (Edit) לכתיבה (Write).Edit: מיועד לביצוע שינויים כירורגיים בקבצים קיימים (Surgical Edits). הוא דורש זיהוי מדויק של הבלוק המיועד להחלפה. כלי זה חיוני לשמירה על שלמות הקובץ ומניעת דריסה של קוד לא רלוונטי.5Write: משמש ליצירת קבצים חדשים מאפס או לדריסה מלאה של קבצים קיימים. השימוש בו אגרסיבי יותר ודורש הרשאות File Modification.5MultiEdit: גרסה מתקדמת המאפשרת ביצוע מספר עריכות במקביל על פני קבצים שונים או מיקומים שונים באותו קובץ. כלי זה מפחית משמעותית את ה-Latency בתהליכי Refactoring מורכבים על ידי צמצום מספר סבבי השיחה (Round trips) הנדרשים.5Bash: הכלי החזק (והמקון) ביותרכלי ה-Bash מעניק לסוכן גישה ישירה למעטפת (Shell) של מערכת ההפעלה.ארכיטקטורה Schema-less: בניגוד לכלים אחרים הדורשים מבנה JSON קשיח, כלי ה-Bash מיושם לעיתים כ-Schema-less, כאשר המודל מייצר את מחרוזת הפקודה ישירות. זה מעניק גמישות אינסופית אך מקשה על אימות סטטי (Static Validation) של הפקודות.7שימושים: ניהול גרסאות (git), התקנת תלויות (npm, pip), הרצת בדיקות, ודיאגנוסטיקה (ps, env).סיכוני אבטחה: זהו הכלי הרגיש ביותר. גישה בלתי מבוקרת ל-Bash שקולה להענקת גישת Shell למשתמש מרוחק. לכן, מערכת ההרשאות מתמקדת בו באופן ספציפי (ראו פרק האבטחה).62.3. כלים ייעודיים ורשת (Specialized & Network Tools)NotebookEdit / NotebookRead: כלים ייעודיים לעבודה עם מחברות Jupyter (.ipynb). המבנה המורכב של קבצי JSON אלו מקשה על עריכה טקסטואלית רגילה, ולכן פותחו כלים אלו המבינים את הסמנטיקה של תאים (Cells) ופלטים.5WebFetch: כלי חדש (בטא מספטמבר 2025) המאפשר לסוכן לאחזר תוכן מלא מכתובות URL, כולל דפי HTML ומסמכי PDF. יכולת זו קריטית לקריאת תיעוד ספריות עדכני שאינו נמצא בזיכרון האימון של המודל.8WebSearch: מאפשר ביצוע שאילתות במנועי חיפוש. משמש לרוב כצעד ראשון בפתרון תקלות (Debugging) כאשר הסוכן נתקל בשגיאה לא מוכרת.5Task & TodoWrite: כלים לניהול מצב פנימי (Internal State Management). Task מאפשר לסוכן לפרק משימה גדולה לתת-משימות ולעקוב אחר ההתקדמות, בעוד TodoWrite משמש לתיעוד חוב טכני או משימות עתידיות שזוהו במהלך ה-Session.52.4. קריאה פרוגרמטית לכלים (Programmatic Tool Calling)עדכון משמעותי במודל Claude Opus 4.5 הציג את היכולת ל-Programmatic Tool Calling. מנגנון זה מאפשר למודל "לשרשר" קריאות לכלים בתוך אותו מחזור הרצה (Inference loop), במקום להמתין לאישור משתמש או לעצור לאחר כל פעולה. לדוגמה, הסוכן יכול להריץ בדיקה (Bash), לקרוא את השגיאה, ולאתר את הקובץ הבעייתי (Grep) ברצף אחד. יכולת זו משפרת דרמטית את הביצועים ומפחיתה את עלויות ה-Token.83. ארכיטקטורת שליטה ובקרה: Hooksבעוד הכלים מספקים את היכולת, מערכת ה-Hooks מספקת את השליטה. Hooks הם סקריפטים המוגדרים על ידי המשתמש (User-defined shell commands) ורצים באופן דטרמיניסטי בנקודות קריטיות במחזור החיים של הסוכן. הם מאפשרים לאכוף מדיניות, להזריק הקשר, או למנוע פעולות מסוכנות, ללא תלות בשיקול הדעת ההסתברותי של המודל.93.1. מחזור החיים ואירועי Hook (Lifecycle Events)הבנת סדר האירועים הכרחית לבניית אינטגרציות אמינות:UserPromptSubmit:תיאור: מופעל מיד לאחר שהמשתמש לוחץ Enter, ולפני שהבקשה נשלחת למודל.שימוש טקטי: ולידציה של הקלט (למשל, מניעת שליחת מידע סודי בטעות), או הזרקת הקשר אוטומטית (כגון הוספת סכמת ה-DB לכל שאילתה).חסימה: החזרת Exit Code 2 תחסום את שליחת ה-Prompt ותציג שגיאה למשתמש.10PreToolUse:תיאור: נקודת ההתערבות הקריטית ביותר. רץ לאחר שהמודל החליט להשתמש בכלי, אך לפני הביצוע בפועל.שימוש טקטי: בדיקת פרמטרים (Sanitization). למשל, Hook שמזהה ניסיון עריכה לקובץ .env וחוסם אותו.משוב למודל (Feedback Loop): ה-Hook יכול להחזיר פלט JSON המנחה את המודל לשנות את האסטרטגיה ("אינך מורשה לערוך קובץ זה, אנא הצע פתרון אחר").11PermissionRequest:תיאור: מופעל כאשר המערכת מזהה צורך באישור משתמש (למשל, הרצת פקודת Bash במצב default).שימוש טקטי: אוטומציה של אישורים (Allow/Deny) המבוססת על לוגיקה מורכבת שאינה ניתנת לביטוי ב-Allowlist פשוט (למשל, "אשר את כל בקשות הרשת ל-api.internal.corp").11PostToolUse:תיאור: רץ לאחר שהכלי סיים את פעולתו בהצלחה.שימוש טקטי: פירמוט אוטומטי (prettier), הרצת Linter, עדכון תיעוד, או דיווח למערכות ניטור חיצוניות.93.2. סכימת נתונים ופרוטוקול תקשורתהתקשורת בין Claude Code לבין ה-Hooks מתבצעת באמצעות stdin (קלט) ו-stdout (פלט) בפורמט JSON.סכימת הקלט (Input Schema - stdin):כל Hook מקבל אובייקט JSON המכיל את ההקשר הנוכחי:JSON{
  "session_id": "sess_12345",
  "transcript_path": "/path/to/logs.json",
  "cwd": "/current/working/dir",
  "permission_mode": "default", // או acceptEdits, dontAsk
  "hook_event_name": "PreToolUse",
  // שדות ספציפיים לאירוע (לדוגמה עבור PreToolUse):
  "tool_name": "Edit",
  "tool_input": { "file_path": "src/main.ts", "content": "..." },
  "tool_use_id": "tool_u_123"
}
11קודי יציאה (Exit Codes) ולוגיקת חסימה:0 (Success): הסקריפט רץ בהצלחה, הסוכן ממשיך כרגיל.1 (Error): שגיאה כללית בסקריפט ה-Hook.2 (Block): פעולה חוסמת. הסוכן יעצור או שהכלי יסורב.פלט מתקדם (Advanced JSON Output):במקום להסתפק בקודי יציאה בינאריים, ה-Hook יכול להדפיס אובייקט JSON ל-stdout כדי לספק משוב סמנטי:JSON{
  "decision": "block", // או "approve"
  "reason": "Security Policy Violation: Edits to locked files are prohibited.",
  "continue": false
}
מבנה זה מאפשר ל-Claude Code להבין מדוע הפעולה נחסמה ולהסביר זאת למשתמש או לנסות נתיב פעולה אלטרנטיבי.114. פרוטוקול הקשר המודל (MCP): שכבת הקישוריותפרוטוקול Model Context Protocol (MCP) הוא הסטנדרט שבאמצעותו Claude Code מתממשק למערכות חיצוניות. MCP הופך כל מקור מידע (Database, Jira, GitHub) ל"שרת" החושף משאבים (Resources), הנחיות (Prompts) וכלים (Tools) עבור הלקוח (Claude).124.1. שיטות תעבורה (Transport Mechanisms)הגדרת שרתי MCP תומכת במספר ארכיטקטורות תעבורה, בהתאם למיקום השרת ורמת האבטחה הנדרשת:Stdio (מקומי):מנגנון: שרת ה-MCP רץ כתהליך משנה (Sub-process) מקומי ש-Claude Code מריץ. התקשורת מתבצעת דרך Standard Input/Output.שימוש: אידיאלי לכלים הדורשים גישה לקבצים מקומיים או הרצת סקריפטים רגישים.קונפיגורציה: claude mcp add --transport stdio <name> -- <command>.14HTTP (מרוחק):מנגנון: שרת ה-MCP רץ כשירות Web (למשל, בתוך Docker או בענן). Claude מתחבר אליו כ-Client באמצעות HTTP/SSE.שימוש: מאפשר שרתים מנוהלים מרכזית (למשל, שרת MCP ארגוני המחובר ל-Salesforce) ללא צורך בהתקנה מקומית אצל כל מפתח.קונפיגורציה: claude mcp add --transport http <name> <url>.14SSE (Deprecated): תעבורת SSE ישירה מוחלפת בהדרגה לטובת סטנדרט ה-HTTP המלא.144.2. היררכיית תצורה וניהול (Configuration Scopes)ניהול שרתי MCP מתבצע במספר רמות (Scopes), המבטיחות איזון בין גמישות אישית לאכיפה ארגונית. הקונפליקטים נפתרים לפי סדר קדימות ברור:Scopeקובץ הגדרהמיקוםסמכותמטרהManagedmanaged-mcp.json/etc/claude-code/ (Linux), /Library/... (Mac)עליונהאכיפת כלים ארגוניים חובה וחסימת כלים אסורים. לא ניתן לעקיפה על ידי המשתמש.14Project.mcp.jsonשורש הפרויקט (Git Root)בינוניתשיתוף כלים ברמת הצוות (Commit to Git). דורש אישור אקטיבי של המשתמש בעת הטעינה למניעת הרצת קוד זדוני מ-Repo לא מוכר.14User/Local~/.claude.jsonתיקיית הבית של המשתמשתחתונההעדפות אישיות וכלים גלובליים למפתח הבודד (כגון לוח שנה אישי).145. ניהול הקשר וזיכרון: CLAUDE.mdמעבר לכלים ול-Hooks, היכולת של Claude Code להבין את הפרויקט תלויה ב"זיכרון" המוזרק לו. קובץ ה-CLAUDE.md משמש כנקודת הכניסה הראשית להגדרת הקשר זה.5.1. מבנה ואסטרטגיית טעינהכאשר Claude Code מופעל, הוא סורק את מערכת הקבצים בחיפוש אחר CLAUDE.md. המנגנון פועל באופן רקורסיבי: החל מהתיקייה הנוכחית (cwd) ועד לשורש הפרויקט. תכונה זו מאפשרת ליצור הקשר היררכי:קובץ שורש (/CLAUDE.md) המגדיר סטנדרטים גלובליים (Coding Style).קובץ תת-תיקייה (/src/frontend/CLAUDE.md) המגדיר חוקים ספציפיים ל-React.155.2. מודולריות באמצעות Imports ו-Rulesבפרויקטים גדולים, קובץ מונוליטי יחיד הופך לבלתי ניתן לניהול. Claude Code מציע שני מנגנונים לפתרון:Imports: תחביר @path/to/file בתוך קובץ ה-Markdown מאפשר לטעון קבצים נוספים דינמית. מומלץ לחלק את ההנחיות לקבצים נושאיים (למשל, @rules/testing.md, @rules/deployment.md).15ספריית .claude/rules/: זוהי השיטה המומלצת לפרויקטי Enterprise. ניתן למקם בתיקייה זו קבצי Markdown המכילים YAML Frontmatter להגדרת ה-Scope שלהם:YAMLpaths:
  - "src/**/*.ts"
  - "src/**/*.tsx"
הגדרה זו מבטיחה שהכללים בקובץ ייטענו להקשר המודל רק כאשר הסוכן עובד על קבצים התואמים לתבנית ה-Glob. אופטימיזציה זו קריטית לחיסכון ב-Tokens ולמניעת "זיהום הקשר" (Context Pollution).156. אינטגרציות ו-CI/CDClaude Code תוכנן להשתלב באופן טבעי בצנרת הפיתוח האוטומטית (Pipeline), תוך הרחבת היכולות מעבר למסוף המקומי.6.1. GitHub Actions: הסוכן כחבר צוותה-Action הרשמי anthropics/claude-code-action מאפשר להריץ את Claude כחלק מתהליך ה-CI.Triggers: ניתן להגדיר את ה-Action לרוץ בתגובה ל-issue_comment או pull_request_review_comment. זה מאפשר תרחיש עבודה שבו מתייגים @claude בתגובה ל-PR כדי לבקש Refactoring או תיקון באג.16הרשאות נדרשות: ה-Action דורש הרשאות כתיבה (Write) ל-contents (לשינוי קוד), issues ו-pull-requests (לתקשורת).ניהול סודות: מפתח ה-API (ANTHROPIC_API_KEY) חייב להיות מוזרק דרך GitHub Secrets. אסור בתכלית האיסור לקודד אותו בקבצי הקונפיגורציה.סיכון אבטחה (Non-Write Users): ה-Action כולל פרמטר בשם allowed_non_write_users. הפעלתו מסווגת כסיכון גבוה (High Risk), שכן היא מאפשרת למשתמשים ללא הרשאות כתיבה ל-Repo להפעיל את הסוכן, מה שעלול להוביל לבזבוז משאבים (API Costs) או לביצוע מניפולציות בקוד דרך הסוכן.166.2. אינטגרציית ענן (AWS & GCP)עבור ארגונים הדורשים שמירת מידע (Data Residency) ותאימות רגולטורית, Claude Code תומך בעבודה מול AWS Bedrock ו-Google Vertex AI.AWS Bedrock: מסתמך על פרופיל ה-AWS המקומי (~/.aws/credentials) או על IAM Roles (כאשר רץ ב-EC2/Lambda). נדרשת הרשאת bedrock:InvokeModel.Google Vertex AI: משתמש ב-Google Cloud SDK (gcloud auth) וב-Application Default Credentials. יש לוודא שה-API aiplatform.googleapis.com מופעל בפרויקט.17אכיפה ארגונית: ניתן לכפות שימוש ב-Provider ספציפי דרך managed-settings.json כדי להבטיח שלא יישלח מידע לנקודות הקצה הציבוריות של Anthropic.67. אבטחה, פרטיות וממשל ארגוני (Security & Governance)הטמעת סוכן אוטונומי בעל הרשאות Shell מחייבת גישת אבטחה רב-שכבתית.7.1. מדיניות שמירת נתונים (Data Retention)ברירת מחדל: היסטוריית השיחה נשמרת ל-30 יום לצורכי ניטור שימוש לרעה (Abuse Monitoring).Enterprise / ZDR: עבור לקוחות מסחריים וארגוניים, קיימת אופציה ל-Zero Data Retention (ZDR). במצב זה, לוגים של ה-API נמחקים מיידית או בתוך חלון זמן קצר מאוד (כגון 7 ימים, החל מעדכוני סוף 2025), מה שמבטיח שמידע רגיש אינו נשמר בשרתי הספק.18הצפנה: כל הנתונים מוצפנים במעבר (TLS 1.2+) ובמנוחה (AES-256). מפת הדרכים כוללת תמיכה עתידית ב-BYOK (Bring Your Own Key) לניהול מפתחות הצפנה על ידי הלקוח.207.2. ניהול הרשאות (Managed Settings)קובץ ה-managed-settings.json הוא הכלי המרכזי של מנהלי ה-IT לשליטה בהתנהגות הכלי ברמת הארגון.Disable Bypass: ניתן לחסום את היכולת של משתמשים להשתמש בדגל --dangerously-skip-permissions באמצעות המפתח disableBypassPermissionsMode: "disable".שליטה ב-MCP: שימוש ברשימות היתר/חסימה (allowedMcpServers, deniedMcpServers) כדי למנוע התקנת שרתים לא מאושרים.Marketplace Restriction: הגבלת מקורות ההתקנה של תוספים (Plugins) באמצעות strictKnownMarketplaces.217.3. בידוד וארגז חול (Sandboxing)המלצת האבטחה הגורפת היא להריץ את Claude Code בסביבה מבודדת:וירטואליזציה: הרצה בתוך Docker Container או VM ייעודי כדי להגביל את "רדיוס הפיצוץ" (Blast Radius) במקרה של הרצת פקודה הרסנית (כגון מחיקת קבצים בשוגג).בידוד רשת: שימוש בפרוקסי ארגוני לפיקוח על תעבורה יוצאת. ניתן להגדיר משתני סביבה ב-managed-settings כדי לכפות ניתוב דרך פרוקסי.22Least Privilege: הסוכן לעולם לא ירוץ כ-root. הרשאות המשתמש המריץ צריכות להיות מוגבלות לתיקיית הפרויקט בלבד.238. סיכוםClaude Code אינו "עוד כלי AI", אלא פלטפורמת ריצה (Runtime) לסוכני פיתוח. השילוב בין מערכת כלים גמישה, ארכיטקטורת Hooks לאירועים, ופרוטוקול MCP לקישוריות, יוצר אקוסיסטם שלם המאפשר אוטומציה עמוקה של תהליכי הפיתוח. ההצלחה בהטמעת הכלי בארגון תלויה לא רק בהתקנתו, אלא בקונפיגורציה קפדנית של הרשאות, בניית הקשר נכון באמצעות CLAUDE.md, ויישום מנגנוני הגנה היקפיים.נספח: טבלאות סיכום מהירותטבלה 1: סוגי קבצי הגדרות וסמכויותסוג הגדרהנתיב (Linux/Mac)רמת סמכותשימוש עיקריManaged/etc/claude-code/managed-settings.jsonעליונה (Absolute)מדיניות אבטחה ארגונית, חסימת עקיפותLocal.claude/settings.local.jsonגבוהה (Override)בדיקות מקומיות, הגדרות ספציפיות למכונהProject.claude/settings.jsonבינוניתנורמות צוותיות, הגדרות כלים משותפותUser~/.claude/settings.jsonנמוכההעדפות אישיות, מפתחות API גלובלייםטבלה 2: כלי ליבה ורמות סיכוןכליפונקציהפרמטרים עיקרייםרמת סיכוןBashהרצת פקודות מעטפתcommand (Schema-less)קריטיEditשינוי תוכן קובץfile_path, edit_instructionsגבוהWriteיצירה/דריסת קובץfile_path, contentגבוהReadקריאת קובץfile_pathנמוךLSרשימת קבציםpath, ignoreנמוךGrepחיפוש תוכןpattern, pathנמוך